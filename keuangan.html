<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data Keuangan</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100">

<header class="bg-blue-800 text-white text-center p-4">
<h2 class="text-xl font-bold">A-Yudi-Thea</h2>
<p>Data Keuangan</p>
</header>

<div class="max-w-4xl mx-auto p-4">

<h3 class="text-lg font-semibold mb-3">ðŸ“’ Data Saldo</h3>

<div class="bg-white rounded shadow p-4 mb-4 text-center">
<p class="text-sm">Saldo Rekening Bersama</p>
<p id="saldoAkhir" class="text-3xl font-bold text-green-600">Memuatâ€¦</p>
</div>

<div class="overflow-x-auto bg-white rounded shadow">
<table class="w-full text-sm">
<thead class="bg-blue-700 text-white">
<tr>
<th class="p-2">Tanggal</th>
<th class="p-2">Keterangan</th>
<th class="p-2">Masuk</th>
<th class="p-2">Keluar</th>
<th class="p-2">Saldo</th>
</tr>
</thead>
<tbody id="saldoTabel"></tbody>
</table>
</div>

</div>

<script>
const sheetId = "1TNhwC9WaZza1MXvIKqUYjk4PgliSDKfRQgh6WfV4-o0";
const sheetName = "SALDO";

fetch(`https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?sheet=${sheetName}`)
.then(res => res.text())
.then(text => {
  const data = JSON.parse(text.substring(47).slice(0,-2));
  const rows = data.table.rows;

  let html = "";
  let saldoTerakhir = 0;

  rows.forEach(r => {
    const tgl = r.c[0]?.v || "";
    const ket = r.c[1]?.v || "";
    const masuk = Number(r.c[2]?.v || 0);
    const keluar = Number(r.c[3]?.v || 0);
    const saldo = r.c[4]?.v;

    // skip baris kosong
    if(!tgl && !ket && masuk===0 && keluar===0 && !saldo) return;

    if(saldo !== null && saldo !== undefined) saldoTerakhir = saldo;

    html += `
      <tr class="border-b">
        <td class="p-2">${tgl}</td>
        <td class="p-2">${ket}</td>
        <td class="p-2">Rp ${masuk.toLocaleString("id-ID")}</td>
        <td class="p-2">Rp ${keluar.toLocaleString("id-ID")}</td>
        <td class="p-2 font-bold">Rp ${(saldo||0).toLocaleString("id-ID")}</td>
      </tr>`;
  });

  document.getElementById("saldoTabel").innerHTML = html;
  document.getElementById("saldoAkhir").innerText =
    "Rp " + Number(saldoTerakhir).toLocaleString("id-ID");
})
.catch(err=>{
  document.getElementById("saldoAkhir").innerText="Gagal ambil data";
  console.error(err);
});
</script>

</body>
</html>